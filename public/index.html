<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <title>PPE Stock ‚Äì Dashboard 2025</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font & Icons -->
    <link
      rel="preconnect"
      href="https://fonts.googleapis.com"
    />
    <link
      rel="preconnect"
      href="https://fonts.gstatic.com"
      crossorigin
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Sarabun:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- Chart.js (‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .page {
            width: 100%;
        }
        .page.hidden {
            display: none;
        }
    </style>

    <style>
      :root {
        --bg: #0f172a;
        --teal: #14b8a6;
      }

      body {
        font-family: "Inter", "Sarabun", sans-serif;
        background: #0f172a;
      }

      /* scroll bar */
      ::-webkit-scrollbar {
        width: 6px;
      }
      ::-webkit-scrollbar-track {
        background: #0f172a;
      }
      ::-webkit-scrollbar-thumb {
        background: #334155;
        border-radius: 9999px;
      }

      /* toast transition */
      .toast-enter {
        animation: toast 0.25s ease-out;
      }
      @keyframes toast {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* modal backdrop */
      .backdrop {
        backdrop-filter: blur(6px);
      }
      .toast {
    transition: opacity 0.25s ease-out, transform 0.25s ease-out;
    }

    .toast.hide {
    opacity: 0;
    transform: translateY(-6px);
    }
    </style>
    <style>
    /* ===== Hybrid Modern Dashboard Theme ===== */

    /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏´‡πâ‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á */
    body {
        background: #1f2937; /* slate-800 */
        color: #e2e8f0;      /* slate-200 */
    }

    /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á main content */
    .page-container {
        background: radial-gradient(circle at top, rgba(15,23,42,0) 0%, rgba(15,23,42,0) 40%, rgba(15,23,42,0.35) 100%);
    }

    /* sidebar ‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏°‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏î‡∏≥ */
    aside {
        background: rgba(15, 23, 42, 0.9); /* slate-900/90 */
        border-right: 1px solid rgba(148, 163, 184, 0.08);
        backdrop-filter: blur(10px);
    }

    /* top bar ‡πÉ‡∏´‡πâ‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏ö‡∏≠‡∏î‡∏µ‡πâ‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢ */
    header {
        background: rgba(30, 41, 59, 0.65); /* slate-700/65 */
        border-bottom: 1px solid rgba(148, 163, 184, 0.15);
        backdrop-filter: blur(8px);
    }

    /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏Å‡πÜ ‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÄ‡∏õ‡πá‡∏ô card ‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô */
    .bg-slate-900,
    .bg-slate-900\/40,
    .bg-slate-950\/40 {
        background: rgba(30, 41, 59, 0.6) !important; /* slate-700/60 */
        border-color: rgba(148, 163, 184, 0.12) !important;
    }

    /* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
    table thead {
        background: rgba(15, 23, 42, 0.12) !important;
    }
    table tbody tr:hover {
        background: rgba(15, 23, 42, 0.08) !important;
    }

    /* ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡πâ‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏ô‡∏¥‡∏î */
    .text-slate-50,
    .text-slate-100 {
        color: #e2e8f0 !important; /* slate-200 */
    }
    .text-slate-400 {
        color: #cbd5f5 !important;
    }

    /* ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π‡∏ã‡πâ‡∏≤‡∏¢‡πÄ‡∏ß‡∏•‡∏≤ active ‡πÉ‡∏´‡πâ contrast ‡∏Ç‡∏∂‡πâ‡∏ô (‡∏û‡∏∑‡πâ‡∏ô‡πÄ‡∏Ç‡πâ‡∏° ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ü‡πâ‡∏≤) */
    aside .nav-item.bg-slate-800,
    aside .nav-item.bg-slate-800.text-white,
    aside .nav-item.font-bold {
        background: rgba(15, 118, 110, 0.15) !important; /* teal-700/15 */
        color: #ffffff !important;
        border: 1px solid rgba(45, 212, 191, 0.35);
    }

    /* toast ‡πÉ‡∏´‡πâ‡∏î‡∏π pop ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÉ‡∏´‡∏°‡πà */
    #toastContainer .toast {
        box-shadow: 0 15px 35px rgba(0,0,0,0.25);
    }

    /* modal backdrop ‡πÉ‡∏´‡πâ‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏´‡∏ô‡πà‡∏≠‡∏¢ */
    .backdrop {
        backdrop-filter: blur(8px);
        background: rgba(15, 23, 42, 0.55);
    }

    /* input ‡πÉ‡∏´‡πâ‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ä‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô */
    input[type="text"],
    input[type="number"],
    input[type="date"],
    select,
    textarea {
        background: rgba(15, 23, 42, 0.35) !important;
        border: 1px solid rgba(148, 163, 184, 0.25) !important;
        color: #e2e8f0 !important;
    }
    input::placeholder,
    textarea::placeholder {
        color: rgba(226, 232, 240, 0.5) !important;
    }

    /* empty state ‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏ü‡πâ‡∏≤‡πÜ ‡πÑ‡∏°‡πà‡∏´‡∏°‡πà‡∏ô */
    .empty-state,
    #stockEmptyState > div,
    #issueHistoryEmptyState > div {
        background: rgba(15, 23, 42, 0.12);
    }

    /* low stock list / overdue list ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥ ‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏≠‡πà‡∏≠‡∏ô‡πÜ ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏õ‡∏Å‡∏±‡∏ö‡∏î‡∏≤‡∏£‡πå‡∏Å‡πÑ‡∏î‡πâ */
    #lowStockList .bg-red-50,
    #lowStockList .bg-orange-50,
    #overdueLoansList .bg-red-50 {
        background: rgba(248, 113, 113, 0.08) !important;
    }
    </style>

  </head>
  <body class="min-h-screen bg-slate-900 text-slate-50">
    <!-- Loading Overlay -->
    <div
      id="loadingOverlay"
      class="fixed inset-0 z-[999] hidden bg-slate-950/60 backdrop flex items-center justify-center"
    >
      <div class="flex flex-col items-center gap-3">
        <div
          class="h-12 w-12 rounded-full border-4 border-teal-400 border-t-transparent animate-spin"
        ></div>
        <p class="text-sm text-slate-100">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...</p>
      </div>
    </div>

    <!-- Toast container -->
    <div id="toastContainer" class="fixed top-5 right-5 z-[998] space-y-3"></div>

    <div class="flex min-h-screen">
      <!-- LEFT SIDEBAR -->
      <aside
        class="hidden lg:flex lg:flex-col w-64 bg-slate-950/40 border-r border-slate-800 backdrop-blur-md"
      >
        <div class="flex items-center gap-3 px-5 h-16 border-b border-slate-800">
          <img
            src="/logo.png"
            alt="Logo"
            class="h-10 w-10 rounded-full object-cover bg-slate-900"
            onerror="this.style.display='none'"
          />
          <div>
            <p class="text-sm text-slate-200 font-semibold">PPE Stock</p>
            <p class="text-xs text-slate-400">Safety & Warehouse</p>
          </div>
        </div>

        <nav class="flex-1 px-3 py-5 space-y-1">
          <button
            onclick="showPage('dashboard')"
            class="nav-item w-full flex items-center gap-3 px-3 py-2 rounded-xl text-sm text-slate-200 hover:bg-teal-500/10 hover:text-white transition"
          >
            <i class="fa-solid fa-grip"></i>
            ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
          </button>
          <button
            onclick="showPage('stock')"
            class="nav-item w-full flex items-center gap-3 px-3 py-2 rounded-xl text-sm text-slate-200 hover:bg-teal-500/10 hover:text-white transition"
          >
            <i class="fa-solid fa-boxes-stacked w-5 text-center"></i>
            ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
          </button>
          <button
            onclick="showPage('issue')"
            class="nav-item w-full flex items-center gap-3 px-3 py-2 rounded-xl text-sm text-slate-200 hover:bg-teal-500/10 hover:text-white transition"
          >
            <i class="fa-solid fa-file-circle-plus w-5 text-center"></i>
            ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å
          </button>
          <button
            onclick="showPage('loan')"
            class="nav-item w-full flex items-center gap-3 px-3 py-2 rounded-xl text-sm text-slate-200 hover:bg-teal-500/10 hover:text-white transition"
          >
            <i class="fa-solid fa-hand-holding-hand w-5 text-center"></i>
            ‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô
          </button>
          <button
            onclick="showPage('allHistory')"
            class="nav-item w-full flex items-center gap-3 px-3 py-2 rounded-xl text-sm text-slate-200 hover:bg-teal-500/10 hover:text-white transition"
          >
            <i class="fa-solid fa-clock-rotate-left w-5 text-center"></i>
            ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
          </button>

          <!-- admin -->
          <div id="adminMenu" class="hidden pt-4 mt-4 border-t border-slate-800">
            <p class="px-3 text-xs uppercase text-slate-500 mb-2 tracking-wide">
              Admin
            </p>
            <button
              onclick="showPage('pending')"
              class="nav-item w-full flex items-center gap-3 px-3 py-2 rounded-xl text-sm text-slate-200 hover:bg-teal-500/10 hover:text-white transition"
            >
              <i class="fa-solid fa-hourglass-half w-5 text-center"></i>
              ‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
            </button>
            <button
              onclick="showPage('manage')"
              class="nav-item w-full flex items-center gap-3 px-3 py-2 rounded-xl text-sm text-slate-200 hover:bg-teal-500/10 hover:text-white transition"
            >
              <i class="fa-solid fa-screwdriver-wrench w-5 text-center"></i>
              ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
            </button>
            <button
              onclick="showPage('receive')"
              class="nav-item w-full flex items-center gap-3 px-3 py-2 rounded-xl text-sm text-slate-200 hover:bg-teal-500/10 hover:text-white transition"
            >
              <i class="fa-solid fa-truck-ramp-box w-5 text-center"></i>
              ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏ï‡πá‡∏≠‡∏Å
            </button>
          </div>
        </nav>

        <div class="p-3 border-t border-slate-800">
          <div id="loginSection">
            <button
              onclick="showLoginModal()"
              class="w-full bg-teal-500 hover:bg-teal-400 text-white rounded-xl py-2 text-sm font-medium flex items-center justify-center gap-2"
            >
              <i class="fa-solid fa-right-to-bracket text-sm"></i>
              ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö Admin
            </button>
          </div>
          <div id="logoutSection" class="hidden space-y-2">
            <p class="text-xs text-slate-400">
              ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ô‡∏ä‡∏∑‡πà‡∏≠ <span class="font-semibold text-slate-100">Admin</span>
            </p>
            <button
              onclick="logout()"
              class="w-full bg-slate-800 hover:bg-slate-700 text-slate-100 rounded-xl py-2 text-sm font-medium flex items-center justify-center gap-2"
            >
              <i class="fa-solid fa-right-from-bracket text-sm"></i>
              ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
            </button>
          </div>
        </div>
      </aside>

      <!-- RIGHT SIDE: TOPBAR + PAGES -->
      <div class="flex-1 flex flex-col min-h-screen bg-slate-900">
        <!-- TOP BAR -->
        <header
          class="h-16 flex items-center justify-between px-4 md:px-6 border-b border-slate-800 bg-slate-900/60 backdrop-blur"
        >
          <div class="flex items-center gap-3 lg:hidden">
            <button
              class="p-2 rounded-lg bg-slate-800 text-slate-100"
              onclick="document.querySelector('aside').classList.toggle('hidden')"
            >
              <i class="fa-solid fa-bars"></i>
            </button>
            <p class="text-slate-100 font-semibold">PPE Stock</p>
          </div>

          <div class="hidden md:flex items-center gap-3 flex-1 max-w-md">
            <div class="relative w-full">
              <i
                class="fa-solid fa-magnifying-glass text-slate-500 absolute left-3 top-1/2 -translate-y-1/2 text-sm"
              ></i>
              <input
                id="stockSearch"
                type="text"
                placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå / ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà / ‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å ..."
                class="w-full bg-slate-800 border border-slate-700 rounded-xl pl-10 pr-3 py-2 text-sm text-slate-100 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-teal-500"
              />
            </div>
            <select
              id="categoryFilter"
              class="bg-slate-800 border border-slate-700 text-sm rounded-xl px-3 py-2 text-slate-100 focus:outline-none focus:ring-2 focus:ring-teal-500"
            >
              <option value="">‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>
            </select>
          </div>

          <div class="flex items-center gap-3">
            <button
              onclick="initializeApp()"
              class="h-9 w-9 rounded-full bg-slate-800 flex items-center justify-center text-slate-200 hover:text-white"
              title="‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"
            >
              <i class="fa-solid fa-rotate-right"></i>
            </button>
            <button
              onclick="showLoginModal()"
              id="loginSectionMobile"
              class="h-9 px-3 rounded-full bg-teal-500 text-white text-sm font-medium flex items-center gap-2 lg:hidden"
            >
              <i class="fa-solid fa-user-shield"></i>
              Admin
            </button>
            <button
              onclick="logout()"
              id="logoutSectionMobile"
              class="hidden h-9 px-3 rounded-full bg-slate-800 text-slate-200 text-sm font-medium lg:hidden"
            >
              <i class="fa-solid fa-right-from-bracket"></i>
            </button>
          </div>
        </header>

        <!-- CONTENT -->
        <main class="page-container flex-1 overflow-y-auto p-4 md:p-6 space-y-6">
        <!-- DASHBOARD PAGE -->
        <section id="dashboardPage" class="page space-y-6">
        <!-- ‡∏≠‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à -->
        <div id="dashboardContent" class="space-y-6">
            <!-- KPI BAR -->
            <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 auto-rows-fr">
            <!-- 4 ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° -->
            <div class="relative overflow-hidden bg-gradient-to-br from-teal-500 to-emerald-400 rounded-2xl p-4 shadow-md">
                <p class="text-xs text-white/80">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                <p id="totalItems" class="text-3xl font-bold text-white mt-2">0</p>
                <i class="fa-solid fa-boxes-stacked absolute -right-4 -bottom-2 text-7xl text-white/25"></i>
            </div>
            <div class="relative overflow-hidden bg-slate-900 border border-slate-800 rounded-2xl p-4">
                <p class="text-xs text-slate-400">‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å</p>
                <p id="lowStockItems" class="text-3xl font-bold text-amber-400 mt-2">0</p>
                <p class="text-xs text-slate-500 mt-1">‡∏Ñ‡∏ß‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Ç‡∏≤‡∏î</p>
                <i class="fa-solid fa-triangle-exclamation absolute -right-3 -bottom-2 text-6xl text-amber-500/10"></i>
            </div>
            <div class="relative overflow-hidden bg-slate-900 border border-slate-800 rounded-2xl p-4">
                <p class="text-xs text-slate-400">‡∏Ç‡∏≠‡∏á‡∏´‡∏°‡∏î</p>
                <p id="outOfStockItems" class="text-3xl font-bold text-red-400 mt-2">0</p>
                <p class="text-xs text-slate-500 mt-1">‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏±‡∏î‡∏´‡∏≤‡∏î‡πà‡∏ß‡∏ô</p>
                <i class="fa-solid fa-xmark-circle absolute -right-3 -bottom-2 text-6xl text-red-500/10"></i>
            </div>
            <div class="relative overflow-hidden bg-slate-900 border border-slate-800 rounded-2xl p-4">
                <p class="text-xs text-slate-400">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏£‡∏ß‡∏°</p>
                <p id="totalStockValue" class="text-2xl font-bold text-slate-100 mt-2">‡∏ø0.00</p>
                <p class="text-xs text-slate-500 mt-1">‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢</p>
                <i class="fa-solid fa-sack-dollar absolute -right-3 -bottom-2 text-6xl text-emerald-500/10"></i>
            </div>
            </div>

            <!-- 2 Column Layout -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
            <!-- left -->
            <div class="lg:col-span-2 space-y-4">
                <!-- action center -->
                <div class="bg-slate-900/40 border border-slate-800 rounded-2xl p-4">
                <div class="flex items-center justify-between mb-3">
                    <h2 class="text-sm font-semibold text-slate-100">‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡πà‡∏ß‡∏ô</h2>
                    <p class="text-xs text-slate-500">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</p>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                    <!-- ‡∏õ‡∏∏‡πà‡∏° 4 ‡∏≠‡∏±‡∏ô‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° -->
                    <button onclick="showPage('issue')" class="flex flex-col gap-2 items-start bg-slate-800/50 border border-slate-700 hover:border-teal-500/80 rounded-xl p-3 transition">
                    <span class="h-8 w-8 rounded-lg bg-teal-500/10 text-teal-400 flex items-center justify-center"><i class="fa-solid fa-file-circle-plus"></i></span>
                    <p class="text-sm text-slate-100">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å</p>
                    <p class="text-[10px] text-slate-400">Issue voucher</p>
                    </button>
                    <button onclick="showPage('receive')" class="flex flex-col gap-2 items-start bg-slate-800/50 border border-slate-700 hover:border-teal-500/80 rounded-xl p-3 transition">
                    <span class="h-8 w-8 rounded-lg bg-emerald-500/10 text-emerald-400 flex items-center justify-center"><i class="fa-solid fa-truck-ramp-box"></i></span>
                    <p class="text-sm text-slate-100">‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤</p>
                    <p class="text-[10px] text-slate-400">Receive stock</p>
                    </button>
                    <button onclick="showPage('loan')" class="flex flex-col gap-2 items-start bg-slate-800/50 border border-slate-700 hover:border-teal-500/80 rounded-xl p-3 transition">
                    <span class="h-8 w-8 rounded-lg bg-sky-500/10 text-sky-400 flex items-center justify-center"><i class="fa-solid fa-arrows-left-right-to-line"></i></span>
                    <p class="text-sm text-slate-100">‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô</p>
                    <p class="text-[10px] text-slate-400">Loan Management</p>
                    </button>
                    <button onclick="showPage('pending')" class="flex flex-col gap-2 items-start bg-slate-800/50 border border-slate-700 hover:border-teal-500/80 rounded-xl p-3 transition">
                    <span class="h-8 w-8 rounded-lg bg-amber-500/10 text-amber-300 flex items-center justify-center"><i class="fa-solid fa-hourglass-half"></i></span>
                    <p class="text-sm text-slate-100">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
                    <p class="text-[10px] text-slate-400">Admin only</p>
                    </button>
                </div>
                </div>

                <!-- charts row -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                <div class="bg-slate-900/40 border border-slate-800 rounded-2xl p-4">
                    <h2 class="text-sm font-semibold text-slate-100 mb-3">‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</h2>
                    <div class="h-52">
                    <canvas id="categoryChart"></canvas>
                    </div>
                </div>
                <div class="bg-slate-900/40 border border-slate-800 rounded-2xl p-4">
                    <h2 class="text-sm font-semibold text-slate-100 mb-3">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏ö‡∏¥‡∏Å‡∏ö‡πà‡∏≠‡∏¢</h2>
                    <div class="h-52">
                    <canvas id="topIssuedItemsChart"></canvas>
                    </div>
                </div>
                </div>

                <!-- history -->
                <div class="bg-slate-900/40 border border-slate-800 rounded-2xl p-4">
                <h2 class="text-sm font-semibold text-slate-100 mb-3">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h2>
                <div id="recentActivityFeed" class="space-y-2 max-h-72 overflow-y-auto"></div>
                </div>
            </div>

            <!-- right column -->
            <div class="space-y-4">
                <div class="bg-slate-900/40 border border-slate-800 rounded-2xl p-4">
                <h2 class="text-sm font-semibold text-slate-100 mb-3">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î / ‡∏Ñ‡∏ß‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h2>
                <div id="lowStockList" class="space-y-2"></div>
                </div>
                <div class="bg-slate-900/40 border border-slate-800 rounded-2xl p-4">
                <h2 class="text-sm font-semibold text-slate-100 mb-3">‡∏¢‡∏∑‡∏°‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î</h2>
                <div id="overdueLoansList" class="space-y-2"></div>
                </div>
            </div>
            </div>
        </div>

        <!-- ‡∏≠‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≠‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î -->
        <div id="dashboardSkeleton" class="hidden">
            <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4">
            <div class="h-24 bg-slate-800/60 rounded-2xl animate-pulse"></div>
            <div class="h-24 bg-slate-800/60 rounded-2xl animate-pulse"></div>
            <div class="h-24 bg-slate-800/60 rounded-2xl animate-pulse"></div>
            <div class="h-24 bg-slate-800/60 rounded-2xl animate-pulse"></div>
            </div>
        </div>
        </section>

        <section id="stockPage" class="page hidden">
        <div class="bg-slate-900/40 border border-slate-800 rounded-2xl overflow-hidden">
            <div class="p-4 border-b border-slate-800 flex items-center justify-between">
            <h3 class="text-sm font-semibold text-slate-100">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå PPE</h3>
            </div>
            <div class="overflow-x-auto">
            <table class="w-full text-sm">
                <thead class="bg-slate-900/60 text-left text-slate-300">
                <tr>
                    <th class="px-6 py-3">‡∏£‡∏´‡∏±‡∏™</th>
                    <th class="px-6 py-3">‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</th>
                    <th class="px-6 py-3">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                    <th class="px-6 py-3">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                    <th class="px-6 py-3">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏∑‡∏°</th>
                    <th class="px-6 py-3">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                </tr>
                </thead>
                <tbody id="stockTableBody" class="divide-y divide-slate-800"></tbody>
            </table>
            <div id="stockEmptyState" class="hidden"></div>
            </div>
        </div>
        </section>       

<!-- PAGES ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏Ñ‡∏á id ‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏ß‡πâ -->

<!-- 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å -->
<section id="issuePage" class="page hidden">
  <div class="p-4 md:p-6 space-y-4">
    <div class="flex items-center justify-between">
      <h2 class="text-lg font-semibold text-slate-100">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å PPE</h2>
      <button
        type="button"
        onclick="addIssueItem()"
        class="px-3 py-1.5 rounded-lg bg-teal-500 text-white text-sm hover:bg-teal-600"
      >
        + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
      </button>
    </div>

    <form
      id="issueForm"
      onsubmit="handleIssueSubmit(event)"
      class="space-y-4 bg-slate-900/40 border border-slate-800 rounded-2xl p-4"
    >
      <div class="grid gap-4 md:grid-cols-2">
        <div>
          <label for="issueUser" class="text-xs text-slate-400">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å</label>
          <input
            id="issueUser"
            class="mt-1 w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-slate-100"
            placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÅ‡∏ú‡∏ô‡∏Å‡∏ú‡∏•‡∏¥‡∏ï"
            required
          />
        </div>
        <div>
          <label for="issueDepartment" class="text-xs text-slate-400">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô/‡πÅ‡∏ú‡∏ô‡∏Å</label>
          <input
            id="issueDepartment"
            class="mt-1 w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-slate-100"
            placeholder="‡πÄ‡∏ä‡πà‡∏ô Production, SHE, QA"
            required
          />
        </div>
      </div>

      <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡πÄ‡∏ö‡∏¥‡∏Å -->
      <div id="issueItems" class="space-y-3">
        <!-- ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏ß‡πâ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô addIssueItem() ‡∏à‡∏∞‡πÄ‡∏ï‡∏¥‡∏°‡πÉ‡∏´‡πâ -->
      </div>

      <div class="flex items-center justify-between">
        <p class="text-xs text-slate-500">
          ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏à‡∏≤‡∏Å‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
        </p>
        <button
          type="submit"
          class="px-4 py-2 rounded-lg bg-teal-500 text-white text-sm hover:bg-teal-600"
        >
          ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å
        </button>
      </div>
    </form>
  </div>
</section>

<!-- 2. ‡∏¢‡∏∑‡∏° - ‡∏Ñ‡∏∑‡∏ô -->
<section id="loanPage" class="page hidden">
  <div class="p-4 md:p-6 space-y-6">
    <h2 class="text-lg font-semibold text-slate-100 mb-2">‡∏¢‡∏∑‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå / PPE</h2>

    <form
      id="loanForm"
      onsubmit="handleBorrowSubmit(event)"
      class="bg-slate-900/40 border border-slate-800 rounded-2xl p-4 space-y-4"
    >
      <div class="grid gap-4 md:grid-cols-2">
        <div>
          <label class="text-xs text-slate-400">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°</label>
          <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏à‡∏≤‡∏Å populateAllDropdowns() -->
          <select
            id="loanItem"
            class="mt-1 w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-slate-100"
            required
          ></select>
        </div>
        <div>
          <label class="text-xs text-slate-400">‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°</label>
          <input
            id="borrowerName"
            class="mt-1 w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-slate-100"
            placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• / ‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô"
            required
          />
        </div>
        <div>
          <label class="text-xs text-slate-400">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô</label>
          <input
            id="loanDueDate"
            type="date"
            class="mt-1 w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-slate-100"
            required
          />
        </div>
        <div>
          <label class="text-xs text-slate-400">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
          <input
            id="loanNotes"
            class="mt-1 w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-slate-100"
            placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÉ‡∏ä‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏á‡∏≤‡∏ô, ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å"
          />
        </div>
      </div>

      <div class="flex justify-end">
        <button type="submit" class="px-4 py-2 rounded-lg bg-teal-500 text-white text-sm">
          ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°
        </button>
      </div>
    </form>

    <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏∑‡∏° -->
    <div class="bg-slate-900/40 border border-slate-800 rounded-2xl">
      <div class="p-4 border-b border-slate-800 flex items-center justify-between">
        <h3 class="text-sm font-semibold text-slate-100">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏∑‡∏°</h3>
      </div>
      <div id="onLoanEmptyState" class="hidden p-4"></div>
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead class="bg-slate-900/60 text-left text-slate-300">
            <tr>
              <th class="px-6 py-3">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</th>
              <th class="px-6 py-3">‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°</th>
              <th class="px-6 py-3">‡∏¢‡∏∑‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠</th>
              <th class="px-6 py-3">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô</th>
              <th class="px-6 py-3 text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
            </tr>
          </thead>
          <tbody id="onLoanTableBody" class="divide-y divide-slate-800"></tbody>
        </table>
      </div>
    </div>

    <!-- ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô -->
    <div class="bg-slate-900/40 border border-slate-800 rounded-2xl">
      <div class="p-4 border-b border-slate-800 flex items-center justify-between">
        <h3 class="text-sm font-semibold text-slate-100">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô</h3>
      </div>
      <div id="loanHistoryEmptyState" class="hidden p-4"></div>
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead class="bg-slate-900/60 text-left text-slate-300">
            <tr>
              <th class="px-6 py-3">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</th>
              <th class="px-6 py-3">‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°</th>
              <th class="px-6 py-3">‡∏¢‡∏∑‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠</th>
              <th class="px-6 py-3">‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠</th>
              <th class="px-6 py-3">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
            </tr>
          </thead>
          <tbody id="loanHistoryTableBody" class="divide-y divide-slate-800"></tbody>
        </table>
      </div>
    </div>
  </div>
</section>

<!-- 3. ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÉ‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -->
<section id="allHistoryPage" class="page hidden">
  <div class="p-4 md:p-6 space-y-4">
    <h2 class="text-lg font-semibold text-slate-100">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
    <div class="bg-slate-900/40 border border-slate-800 rounded-2xl">
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead class="bg-slate-900/60 text-left text-slate-300">
            <tr>
              <th class="px-6 py-3">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å</th>
              <th class="px-6 py-3">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
              <th class="px-6 py-3">‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å</th>
              <th class="px-6 py-3">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
              <th class="px-6 py-3 text-right">‡∏î‡∏π</th>
            </tr>
          </thead>
          <tbody id="historyTableBody" class="divide-y divide-slate-800"></tbody>
        </table>
      </div>
      <div id="issueHistoryEmptyState" class="hidden p-4"></div>
    </div>
  </div>
</section>

<!-- 4. ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (Admin) -->
<section id="pendingPage" class="page hidden admin-page">
  <div class="p-4 md:p-6 space-y-4">
    <h2 class="text-lg font-semibold text-slate-100">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</h2>
    <div class="bg-slate-900/40 border border-slate-800 rounded-2xl">
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead class="bg-slate-900/60 text-left text-slate-300">
            <tr>
              <th class="px-6 py-3">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å</th>
              <th class="px-6 py-3">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
              <th class="px-6 py-3">‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å</th>
              <th class="px-6 py-3">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</th>
              <th class="px-6 py-3 text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
            </tr>
          </thead>
          <tbody id="pendingTableBody" class="divide-y divide-slate-800"></tbody>
        </table>
      </div>
      <div id="pendingEmptyState" class="hidden p-4"></div>
    </div>
  </div>
</section>

<!-- 5. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ PPE (Admin) -->
<section id="managePage" class="page hidden admin-page">
  <div class="p-4 md:p-6 space-y-4">
    <div class="flex items-center justify-between">
    <h2 class="text-lg font-semibold text-slate-100">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå PPE</h2>
    <button
        type="button"
        onclick="showCategoryModal()"
        class="px-3 py-1.5 rounded-lg bg-slate-700 text-slate-100 text-sm hover:bg-slate-600"
    >
        ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
    </button>
    </div>
    <div class="grid gap-4 lg:grid-cols-2">
      <form
        id="manageForm"
        onsubmit="handleManageSubmit(event)"
        class="bg-slate-900/40 border border-slate-800 rounded-2xl p-4 space-y-3"
      >
        <input type="hidden" id="editItemId" />
        <div>
          <label class="text-xs text-slate-400">‡∏£‡∏´‡∏±‡∏™‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</label>
          <input id="itemCode" class="mt-1 w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-slate-100" required />
        </div>
        <div>
          <label class="text-xs text-slate-400">‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</label>
          <input id="itemName" class="mt-1 w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-slate-100" required />
        </div>
        <div>
          <label class="text-xs text-slate-400">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
          <!-- ‡πÉ‡∏ä‡πâ id ‡πÄ‡∏î‡∏¥‡∏° ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ populateAllDropdowns() ‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏î‡πâ -->
          <select id="itemCategory" class="mt-1 w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-slate-100">
            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>
          </select>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div>
            <label class="text-xs text-slate-400">‡∏´‡∏ô‡πà‡∏ß‡∏¢</label>
            <input id="itemUnit" class="mt-1 w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-slate-100" placeholder="‡∏Ñ‡∏π‡πà / ‡∏ä‡∏¥‡πâ‡∏ô / ‡∏ï‡∏±‡∏ß" />
          </div>
          <div>
            <label class="text-xs text-slate-400">‡∏à‡∏∏‡∏î‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</label>
            <input id="itemReorderPoint" type="number" class="mt-1 w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-slate-100" value="0" />
          </div>
          <div>
            <label class="text-xs text-slate-400">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</label>
            <input id="itemStock" type="number" class="mt-1 w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-slate-100" value="0" />
          </div>
        </div>
        <div>
          <label class="text-xs text-slate-400">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏∑‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
          <input id="onLoanQuantity" type="number" class="mt-1 w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-slate-100" value="0" />
        </div>
        <div class="flex justify-end gap-2">
          <button type="button" onclick="resetManageForm()" class="px-3 py-2 rounded-lg bg-slate-700 text-white text-sm">
            ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
          </button>
          <button type="submit" class="px-3 py-2 rounded-lg bg-teal-500 text-white text-sm">
            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
          </button>
        </div>
      </form>

      <div id="manageItemsList" class="space-y-2 bg-slate-900/40 border border-slate-800 rounded-2xl p-4">
        <!-- updateManageItemsList() ‡∏à‡∏∞‡∏°‡∏≤‡πÄ‡∏ï‡∏¥‡∏°‡πÉ‡∏´‡πâ -->
      </div>
    </div>
  </div>
</section>

<!-- 6. ‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏ï‡πá‡∏≠‡∏Å (Admin) -->
<section id="receivePage" class="page hidden admin-page">
  <div class="p-4 md:p-6 space-y-4">
    <h2 class="text-lg font-semibold text-slate-100">‡∏£‡∏±‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏ï‡πá‡∏≠‡∏Å</h2>
    <form
      id="receiveForm"
      onsubmit="handleReceiveSubmit(event)"
      class="bg-slate-900/40 border border-slate-800 rounded-2xl p-4 space-y-4"
    >
      <div class="grid gap-4 md:grid-cols-2">
        <div>
          <label class="text-xs text-slate-400">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</label>
          <select
            id="receiveItem"
            class="mt-1 w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-slate-100"
            required
          ></select>
        </div>
        <div>
          <label class="text-xs text-slate-400">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤</label>
          <input
            id="receiveQuantity"
            type="number"
            min="1"
            class="mt-1 w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-slate-100"
            required
          />
        </div>
        <div>
          <label class="text-xs text-slate-400">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö</label>
          <select
            id="receiveType"
            class="mt-1 w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-slate-100"
          >
            <option value="receive">‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤</option>
            <option value="return">‡∏Ñ‡∏∑‡∏ô‡∏à‡∏≤‡∏Å‡∏¢‡∏∑‡∏°/‡∏ã‡πà‡∏≠‡∏°</option>
            <option value="adjust">‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏¢‡∏≠‡∏î</option>
          </select>
        </div>
        <div>
          <label class="text-xs text-slate-400">‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</label>
          <input
            id="receiveUser"
            class="mt-1 w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-slate-100"
            placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤"
            required
          />
        </div>
        <div>
          <label class="text-xs text-slate-400">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</label>
          <input
            id="receiveDepartment"
            class="mt-1 w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-slate-100"
            placeholder="‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô"
          />
        </div>
      </div>
      <div class="flex justify-end">
        <button type="submit" class="px-4 py-2 rounded-lg bg-teal-500 text-white text-sm">
          ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤
        </button>
      </div>
    </form>
  </div>
</section>
        </main>
      </div>
    </div>

    <!-- LOGIN MODAL (‡πÉ‡∏ä‡πâ‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°) -->
    <div
      id="loginModal"
      class="fixed inset-0 z-[999] hidden bg-slate-950/70 backdrop flex items-center justify-center"
    >
      <div class="bg-slate-900 border border-slate-700 rounded-2xl p-6 w-full max-w-sm">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-base font-semibold text-slate-100">
            ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö
          </h2>
          <button
            onclick="hideLoginModal()"
            class="h-8 w-8 rounded-full bg-slate-800 flex items-center justify-center"
          >
            <i class="fa-solid fa-xmark text-slate-200"></i>
          </button>
        </div>
        <form id="loginForm" class="space-y-3">
          <div class="space-y-1">
            <label class="text-xs text-slate-400">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
            <input
              id="loginUsername"
              type="text"
              class="w-full bg-slate-950/30 border border-slate-700 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-teal-500"
            />
          </div>
          <div class="space-y-1">
            <label class="text-xs text-slate-400">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
            <input
              id="loginPassword"
              type="password"
              class="w-full bg-slate-950/30 border border-slate-700 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-teal-500"
            />
          </div>
          <button
            class="w-full bg-teal-500 hover:bg-teal-400 text-white rounded-lg py-2 text-sm font-medium"
          >
            ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
          </button>
        </form>
      </div>
    </div>

<script>
    // ===========================================
    // API Configuration
    // ===========================================
    const API_BASE = "/api/ppe"; // ‡πÉ‡∏´‡πâ Vercel ‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà

    async function callServerFunction(action, payload = null) {
    showLoading();
    try {
        const response = await fetch(API_BASE, {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
        },
        body: JSON.stringify({ action, payload }),
        });

        if (!response.ok) {
        throw new Error(`Network response was not ok: ${response.status} ${response.statusText}`);
        }

        const result = await response.json();

        // ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡πÉ‡∏´‡πâ backend ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ
        // { success: true, data: {...} } ‡∏´‡∏£‡∏∑‡∏≠ { success: false, message: "..." }
        if (result.success === false) {
        throw new Error(result.message || "API error");
        }

        return result.data ?? result; // ‡πÄ‡∏ú‡∏∑‡πà‡∏≠ backend ‡∏Ñ‡∏∑‡∏ô data ‡∏ï‡∏£‡∏á‡πÜ
    } catch (error) {
        console.error(`API call failed for action "${action}":`, error);
        onFailure(error);
        throw error;
    } finally {
        hideLoading();
    }
    }

    // ===========================================
    // State & Initialization
    // ===========================================
    let isAdmin = false;
    let currentData = { ppeItems: [], issueVouchers: [], receiveTransactions: [], loanTransactions: [], categories: [], dashboardMetrics: {} };
    let categoryChartInstance = null;
    let topIssuedItemsChartInstance = null;

    document.addEventListener('DOMContentLoaded', () => {
    initializeApp(true);
    setupEventListeners();
    showPage('dashboard');

    if (document.getElementById('issueForm')) {
        resetIssueForm();
    }
    });

    function initializeApp(isFirstLoad = false) {
        if (isFirstLoad) showDashboardSkeleton();
        callServerFunction('getInitialData')
            .then(onDataLoaded)
            .catch(onFailure); // Error is already logged in callServerFunction
    }
    
    function onDataLoaded(data) {
        currentData = data;
        console.log("Data loaded:", currentData);
        updateUI();
        hideLoading();
        hideDashboardSkeleton();
    }
    
    function onFailure(error) {
        // The error is already logged in callServerFunction, so we just update the UI
        hideLoading();
        hideDashboardSkeleton();
        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
    }

    function updateUI() {
        if (!currentData || !currentData.ppeItems) return;
        updateDashboard();
        updateAllTablesAndLists();
        populateAllDropdowns();
        updateAdminUI();
        renderCategoryList();
    }

    function setupEventListeners() {
    // login ‡∏°‡∏µ‡πÅ‡∏Ñ‡πà‡πÉ‡∏ô JS ‡∏Å‡πá‡∏û‡∏≠
    document.getElementById('loginForm').addEventListener('submit', handleLogin);

    // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ + filter
    const debouncedFilterStock = debounce(filterStock, 300);
    document.getElementById('stockSearch').addEventListener('input', debouncedFilterStock);
    document.getElementById('categoryFilter').addEventListener('change', filterStock);
    }

    // ===========================================
    // UI Control & Helpers
    // ===========================================
    function showLoading() { document.getElementById('loadingOverlay').classList.remove('hidden'); }
    function hideLoading() { document.getElementById('loadingOverlay').classList.add('hidden'); }
    function showDashboardSkeleton() {
        document.getElementById('dashboardContent').classList.add('hidden');
        document.getElementById('dashboardSkeleton').classList.remove('hidden');
    }
    function hideDashboardSkeleton() {
        document.getElementById('dashboardContent').classList.remove('hidden');
        document.getElementById('dashboardSkeleton').classList.add('hidden');
    }
    function showToast(message, type = 'success') {
        const toastContainer = document.getElementById('toastContainer');
        const toast = document.createElement('div');
        const icon = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle';
        const bgColor = type === 'success' ? 'bg-teal-500' : 'bg-red-500';
        toast.className = `toast p-4 rounded-lg shadow-lg text-white ${bgColor} flex items-center space-x-3`;
        toast.innerHTML = `<i class="fas ${icon} text-xl"></i><span>${message}</span>`;
        toastContainer.appendChild(toast);
        setTimeout(() => {
            toast.classList.add('hide');
            toast.addEventListener('transitionend', () => toast.remove());
        }, 3000);
    }

    function showPage(pageName) {
    // üîπ ‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤
    document.querySelectorAll('.page-container > .page').forEach(page => {
        page.classList.add('hidden');
    });

    // üîπ ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    const pageElement = document.getElementById(`${pageName}Page`);
    if (pageElement) pageElement.classList.remove('hidden');

    // üîπ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏°‡∏ô‡∏π‡∏ã‡πâ‡∏≤‡∏¢‡∏Å‡πà‡∏≠‡∏ô
    document.querySelectorAll('aside .nav-item').forEach(item => {
        item.classList.remove('bg-slate-800', 'text-white', 'font-bold');
    });

    // üîπ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å active
    const activeNavItemDesktop = document.querySelector(
        `aside .nav-item[onclick="showPage('${pageName}')"]`
    );
    if (activeNavItemDesktop) {
        activeNavItemDesktop.classList.add('bg-slate-800', 'text-white', 'font-bold');
    }

    // üîπ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÄ‡∏°‡∏ô‡∏π mobile)
    document.querySelectorAll('.nav-item-mobile').forEach(item => {
        item.classList.remove('text-teal-400');
    });
    const activeNavItemMobile = document.querySelector(
        `.nav-item-mobile[onclick="showPage('${pageName}')"]`
    );
    if (activeNavItemMobile) {
        activeNavItemMobile.classList.add('text-teal-400');
    }

    // üîπ ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á refresh ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    if (pageName === 'dashboard') updateDashboard();
    if (pageName === 'allHistory') {
        updateHistoryTable();
        updateLoanHistoryTable();
    }
    }

    function showHistoryTab(tabName) {
        document.querySelectorAll('.history-tab-content').forEach(content => content.classList.add('hidden'));
        document.querySelectorAll('.history-tab').forEach(tab => {
            tab.classList.remove('border-teal-500', 'text-teal-600');
            tab.classList.add('text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300', 'border-transparent');
        });
        document.getElementById(tabName + 'HistoryTab').classList.remove('hidden');
        const activeTab = document.querySelector(`.history-tab[onclick="showHistoryTab('${tabName}')"]`);
        activeTab.classList.add('border-teal-500', 'text-teal-600');
    }
    function createEmptyState(message, iconClass) {
    return `
        <div class="text-center py-10 px-6 text-slate-400">
        <div class="w-14 h-14 mx-auto bg-slate-800 rounded-full flex items-center justify-center mb-3">
            <i class="${iconClass} text-2xl text-slate-400"></i>
        </div>
        <p class="text-sm">${message}</p>
        </div>
    `;
    }
    function debounce(func, delay) {
        let timeout;
        return (...args) => { clearTimeout(timeout); timeout = setTimeout(() => func.apply(this, args), delay); };
    }

    // ===========================================
    // Authentication
    // ===========================================
    function handleLogin(e) {
        e.preventDefault();
        const username = document.getElementById('loginUsername').value;
        const password = document.getElementById('loginPassword').value;
        callServerFunction('checkAdminCredentials', { username, password })
            .then(isValid => {
                if (isValid) {
                    isAdmin = true;
                    updateAdminUI();
                    hideLoginModal();
                    showToast('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                } else {
                    showToast('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
                }
            });
    }
    function logout() {
        isAdmin = false;
        updateAdminUI();
        showPage('dashboard');
        showToast('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß');
    }
    function updateAdminUI() {
        const adminElements = ['adminMenu']; // ‡∏ï‡∏±‡∏î adminMenuMobile ‡∏≠‡∏≠‡∏Å
        const loginElements = ['loginSection', 'loginSectionMobile'];
        const logoutElements = ['logoutSection', 'logoutSectionMobile'];
        if (isAdmin) {
            adminElements.forEach(id => document.getElementById(id).classList.remove('hidden'));
            loginElements.forEach(id => document.getElementById(id).classList.add('hidden'));
            logoutElements.forEach(id => document.getElementById(id).classList.remove('hidden'));
        } else {
            adminElements.forEach(id => document.getElementById(id).classList.add('hidden'));
            loginElements.forEach(id => document.getElementById(id).classList.remove('hidden'));
            logoutElements.forEach(id => document.getElementById(id).classList.add('hidden'));
        }
    }
    function showLoginModal() { document.getElementById('loginModal').classList.remove('hidden'); }
    function hideLoginModal() { document.getElementById('loginModal').classList.add('hidden'); }

    // ===========================================
    // Data Population & Updates
    // ===========================================
    function updateAllTablesAndLists() {
        filterStock();
        updateHistoryTable();
        updatePendingTable();
        updateManageItemsList();
        updateOnLoanTable();
        updateLoanHistoryTable();
    }
    function populateAllDropdowns() {
        const categoryOptions = [...currentData.categories]
            .sort((a,b) => a.name.localeCompare(b.name))
            .map(cat => `<option value="${cat.name}">${cat.name}</option>`).join('');
        
        document.getElementById('categoryFilter').innerHTML = '<option value="">‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>' + categoryOptions;
        document.getElementById('itemCategory').innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>' + categoryOptions;

        const allItemOptions = currentData.ppeItems
            .sort((a,b) => a.name.localeCompare(b.name))
            .map(item => `<option value="${item.id}">${item.name} (‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${item.stock})</option>`).join('');
        
        document.querySelectorAll('.item-select').forEach(select => {
            const selectedValue = select.value;
            select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</option>' + allItemOptions;
            if(selectedValue) select.value = selectedValue;
        });
        
        document.getElementById('receiveItem').innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</option>' + allItemOptions;

        const loanableItems = currentData.ppeItems.filter(item => item.stock > 0)
            .sort((a,b) => a.name.localeCompare(b.name));
        document.getElementById('loanItem').innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå --</option>' +
            loanableItems.map(item => `<option value="${item.id}">${item.name} (‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ: ${item.stock})</option>`).join('');
    }

    // ===========================================
    // Dashboard Rendering
    // ===========================================
    function updateDashboard() {
        const { ppeItems, issueVouchers, dashboardMetrics } = currentData;
        if (!ppeItems || !issueVouchers || !dashboardMetrics) return;
        document.getElementById('totalItems').textContent = ppeItems.length;
        document.getElementById('lowStockItems').textContent = ppeItems.filter(item => Number(item.stock) > 0 && Number(item.stock) <= Number(item.reorderPoint)).length;
        document.getElementById('outOfStockItems').textContent = ppeItems.filter(item => Number(item.stock) === 0).length;
     // document.getElementById('pendingVouchers').textContent = issueVouchers.filter(v => v.status === 'pending').length;
        document.getElementById('totalStockValue').textContent = `‡∏ø${(dashboardMetrics.totalStockValue || 0).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
        
        updateLowStockList();
        updateOverdueLoansList();
        updateCategoryChart();
        updateTopIssuedItemsChart();
        updateRecentActivityFeed();
    }
    function updateLowStockList() {
        const container = document.getElementById('lowStockList');
        const attentionItems = currentData.ppeItems
            .filter(item => Number(item.stock) <= Number(item.reorderPoint))
            .sort((a, b) => a.stock - b.stock);
        
        if (attentionItems.length === 0) {
            container.innerHTML = createEmptyState('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°', 'fa-solid fa-thumbs-up');
            return;
        }
        container.innerHTML = attentionItems.map(item => {
            const isOutOfStock = Number(item.stock) === 0;
            const statusText = isOutOfStock ? '‡∏Ç‡∏≠‡∏á‡∏´‡∏°‡∏î' : '‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î';
            const bgColor = isOutOfStock ? 'bg-red-50' : 'bg-orange-50';
            const textColor = isOutOfStock ? 'text-red-800' : 'text-orange-800';
            const subTextColor = isOutOfStock ? 'text-red-600' : 'text-orange-600';
            const badgeBgColor = isOutOfStock ? 'bg-red-200' : 'bg-orange-200';

            return `
                <div class="flex justify-between items-center p-2.5 ${bgColor} rounded-lg">
                    <div>
                        <p class="font-medium text-sm ${textColor}">${item.name}</p>
                        <p class="text-xs ${subTextColor}">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${item.stock} ${item.unit}</p>
                    </div>
                    <span class="px-2 py-1 ${badgeBgColor} ${textColor} text-xs rounded-full font-medium">${statusText}</span>
                </div>`;
        }).join('');
    }
    function updateOverdueLoansList() {
        const container = document.getElementById('overdueLoansList');
        const overdueLoans = currentData.loanTransactions.filter(loan => {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            return loan.status === 'on_loan' && new Date(loan.dueDate) < today;
        }).sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));

        if (overdueLoans.length === 0) {
            container.innerHTML = createEmptyState('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏¢‡∏∑‡∏°‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î', 'fa-solid fa-calendar-check');
            return;
        }
        container.innerHTML = overdueLoans.map(loan => {
            const item = currentData.ppeItems.find(p => p.id == loan.itemId);
            return `
                <div class="flex justify-between items-center p-2.5 bg-red-50 rounded-lg">
                    <div>
                        <p class="font-medium text-sm text-red-800">${item ? item.name : 'N/A'}</p>
                        <p class="text-xs text-red-600">‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°: ${loan.borrowerName}</p>
                    </div>
                    <button onclick="showPage('loan')" class="px-3 py-1 bg-red-600 text-white rounded-lg hover:bg-red-700 text-xs transition-colors">
                        ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
                    </button>
                </div>`;
        }).join('');
    }
    function updateRecentActivityFeed() {
        const container = document.getElementById('recentActivityFeed');
        const activities = currentData.dashboardMetrics.recentActivities;

        if (!activities || activities.length === 0) {
            container.innerHTML = createEmptyState('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î', 'fa-solid fa-bell-slash');
            return;
        }
        container.innerHTML = activities.map(activity => {
            const timestamp = new Date(activity.timestamp).toLocaleString('th-TH', { dateStyle: 'short', timeStyle: 'short' });
            let iconClass, textColor = 'text-gray-700';
            switch (activity.type) {
                case 'issue_voucher':
                    iconClass = 'fa-solid fa-file-export text-emerald-600';
                    if (activity.status === 'pending') textColor = 'text-yellow-700';
                    else if (activity.status === 'rejected') textColor = 'text-red-700';
                    break;
                case 'loan_transaction': iconClass = 'fa-solid fa-exchange-alt text-teal-600'; break;
                case 'return_transaction': iconClass = 'fa-solid fa-undo text-lime-600'; break;
                case 'receive_transaction': iconClass = 'fa-solid fa-truck text-green-600'; break;
            }
            return `
                <div class="flex items-start space-x-4 p-3 border-b border-gray-100 last:border-b-0">
                    <i class="${iconClass} text-lg mt-1 w-5 text-center"></i>
                    <div class="flex-1">
                        <p class="text-sm font-medium ${textColor}">${activity.description}</p>
                        <p class="text-xs text-gray-500">${timestamp}</p>
                    </div>
                </div>`;
        }).join('');
    }
    function updateCategoryChart() {
        const ctx = document.getElementById('categoryChart').getContext('2d');
        const categories = {};
        currentData.ppeItems.forEach(item => {
            if (item.category) {
                categories[item.category] = (categories[item.category] || 0) + Number(item.stock);
            }
        });

        if (categoryChartInstance) categoryChartInstance.destroy();
        
        categoryChartInstance = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: Object.keys(categories),
                datasets: [{
                    data: Object.values(categories),
                    backgroundColor: ['#14b8a6', '#0d9488', '#0f766e', '#047857', '#065f46', '#064e3b'],
                    borderColor: '#FFFFFF',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { position: 'bottom', labels: {font: { family: "'Inter', 'Sarabun', sans-serif" }} } },
                onClick: (_, elements) => {
                    if (elements.length > 0) {
                        const categoryName = Object.keys(categories)[elements[0].index];
                        showPage('stock');
                        document.getElementById('categoryFilter').value = categoryName;
                        filterStock();
                    }
                }
            }
        });
    }
    function updateTopIssuedItemsChart() {
        const ctx = document.getElementById('topIssuedItemsChart').getContext('2d');
        const topItems = currentData.dashboardMetrics.topIssuedItems;
        if (!topItems) return;
        if (topIssuedItemsChartInstance) topIssuedItemsChartInstance.destroy();

        topIssuedItemsChartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: topItems.map(item => item.itemName),
                datasets: [{
                    label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢',
                    data: topItems.map(item => item.totalQuantity),
                    backgroundColor: '#14b8a6',
                    borderRadius: 4,
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { display: false }, title: { display: false } },
                scales: { 
                    y: { ticks: { font: { family: "'Inter', 'Sarabun', sans-serif" } } },
                    x: { beginAtZero: true }
                }
            }
        });
    }

    // ===========================================
    // Table Rendering & Filtering
    // ===========================================
    function filterStock() {
        const tbody = document.getElementById('stockTableBody');
        const emptyState = document.getElementById('stockEmptyState');
        const search = document.getElementById('stockSearch').value.toLowerCase();
        const category = document.getElementById('categoryFilter').value;

        let filteredItems = currentData.ppeItems;
        if (search) filteredItems = filteredItems.filter(item => 
            (item.name && item.name.toLowerCase().includes(search)) || 
            (item.code && item.code.toLowerCase().includes(search))
        );
        if (category) filteredItems = filteredItems.filter(item => item.category === category);
        
        if (filteredItems.length === 0) {
            tbody.innerHTML = '';
            emptyState.innerHTML = createEmptyState('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç', 'fa-solid fa-box-open');
            emptyState.classList.remove('hidden');
            return;
        }
        emptyState.classList.add('hidden');

        tbody.innerHTML = filteredItems.map(item => {
            let statusText, statusColor;
            if (Number(item.stock) === 0) {
                statusText = '‡∏Ç‡∏≠‡∏á‡∏´‡∏°‡∏î';
                statusColor = 'bg-red-100 text-red-800';
            } else if (Number(item.stock) <= Number(item.reorderPoint)) {
                statusText = '‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î';
                statusColor = 'bg-orange-100 text-orange-800';
            } else {
                statusText = '‡∏õ‡∏Å‡∏ï‡∏¥';
                statusColor = 'bg-emerald-100 text-emerald-800';
            }
            return `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap font-medium text-slate-100">${item.code}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-slate-100">${item.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-slate-300">${item.category}</td>
                    <td class="px-6 py-4 whitespace-nowrap font-bold text-gray-800">${item.stock} <span class="text-gray-500 font-normal">${item.unit}</span></td>
                    <td class="px-6 py-4 whitespace-nowrap text-gray-500">${item.onLoanQuantity || 0}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2.5 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full ${statusColor}">${statusText}</span>
                    </td>
                </tr>`;
        }).join('');
    }
    function getStatusInfo(status) {
        switch (String(status).trim()) {
            case 'pending': return { text: '‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', color: 'bg-yellow-100 text-yellow-800' };
            case 'approved': return { text: '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß', color: 'bg-emerald-100 text-emerald-800' };
            case 'partially_approved': return { text: '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô', color: 'bg-green-100 text-green-800' };
            case 'rejected': return { text: '‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò', color: 'bg-red-100 text-red-800' };
            case 'completed': return { text: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', color: 'bg-purple-100 text-purple-800' };
            case 'on_loan': return { text: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏∑‡∏°', color: 'bg-blue-100 text-blue-800' };
            case 'returned': return { text: '‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß', color: 'bg-gray-200 text-gray-800' };
            default: return { text: '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞', color: 'bg-gray-100 text-gray-800' };
        }
    }
    function updateHistoryTable() {
        const tbody = document.getElementById('historyTableBody');
        const emptyState = document.getElementById('issueHistoryEmptyState');
        const sortedVouchers = [...currentData.issueVouchers].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        if (sortedVouchers.length === 0) {
            tbody.innerHTML = '';
            emptyState.innerHTML = createEmptyState('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÉ‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å', 'fa-solid fa-file-invoice');
            emptyState.classList.remove('hidden');
            return;
        }
        emptyState.classList.add('hidden');
        tbody.innerHTML = sortedVouchers.map(v => {
            const status = getStatusInfo(v.status);
            return `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap font-medium text-gray-800">#${v.id}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-gray-500">${new Date(v.timestamp).toLocaleDateString('th-TH', { dateStyle: 'medium' })}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-gray-700">${v.user}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2.5 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full ${status.color}">${status.text}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right">
                        <button onclick="showVoucherDetails(${v.id})" class="text-teal-600 hover:text-teal-800 font-medium">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</button>
                    </td>
                </tr>`;
        }).join('');
    }
    function updatePendingTable() { 
       const tbody = document.getElementById('pendingTableBody');
       const emptyState = document.getElementById('pendingEmptyState');
       const pendingVouchers = currentData.issueVouchers.filter(v => v.status === 'pending').sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
       if (pendingVouchers.length === 0) {
           tbody.innerHTML = '';
           emptyState.innerHTML = createEmptyState('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', 'fa-solid fa-inbox');
           emptyState.classList.remove('hidden');
           return;
       }
       emptyState.classList.add('hidden');
       tbody.innerHTML = pendingVouchers.map(voucher => `
           <tr class="hover:bg-gray-50">
               <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">#${voucher.id}</td>
               <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${new Date(voucher.timestamp).toLocaleDateString('th-TH', { dateStyle: 'medium' })}</td>
               <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${voucher.user}</td>
               <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${voucher.department}</td>
               <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-center">
                   <button onclick="showApprovalModal(${voucher.id})" class="px-4 py-2 bg-yellow-400 text-yellow-900 rounded-lg hover:bg-yellow-500 font-semibold transition-colors">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</button>
               </td>
           </tr>
       `).join('');
    }
    function updateManageItemsList() {
        const listContainer = document.getElementById('manageItemsList');
        if (!currentData.ppeItems || currentData.ppeItems.length === 0) { 
            listContainer.innerHTML = createEmptyState('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö', 'fa-solid fa-box-open'); 
            return; 
        }
        listContainer.innerHTML = [...currentData.ppeItems].sort((a,b) => a.name.localeCompare(b.name)).map(item => `
            <div class="flex justify-between items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50">
                <div>
                    <p class="font-medium text-gray-900">${item.name} (${item.code})</p>
                    <p class="text-sm text-gray-600">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${item.stock} ${item.unit} | ‡∏¢‡∏∑‡∏°: ${item.onLoanQuantity || 0}</p>
                </div>
                <button onclick="editItem(${item.id})" class="px-3 py-1.5 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors">
                    <i class="fas fa-edit"></i>
                </button>
            </div>
        `).join('');
    }
    function updateOnLoanTable() {
        const tbody = document.getElementById('onLoanTableBody');
        const emptyState = document.getElementById('onLoanEmptyState');
        const onLoanItems = currentData.loanTransactions.filter(l => l.status === 'on_loan').sort((a, b) => new Date(a.borrowDate) - new Date(b.borrowDate));
        if (onLoanItems.length === 0) {
            tbody.innerHTML = '';
            emptyState.innerHTML = createEmptyState('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°', 'fa-solid fa-people-carry-box');
            emptyState.classList.remove('hidden');
            return;
        }
        emptyState.classList.add('hidden');
        tbody.innerHTML = onLoanItems.map(loan => {
            const item = currentData.ppeItems.find(p => p.id == loan.itemId);
            const today = new Date(); today.setHours(0, 0, 0, 0);
            const isOverdue = new Date(loan.dueDate) < today;
            return `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item ? item.name : 'N/A'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${loan.borrowerName}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${new Date(loan.borrowDate).toLocaleDateString('th-TH')}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${isOverdue ? 'text-red-600 font-bold' : 'text-gray-500'}">
                        ${new Date(loan.dueDate).toLocaleDateString('th-TH')}
                        ${isOverdue ? '<span class="ml-2 text-xs">(‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î)</span>' : ''}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">
                        <button onclick="handleReturnItem(${loan.loanId})" class="px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors">‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô</button>
                    </td>
                </tr>`;
        }).join('');
    }
    function updateLoanHistoryTable() {
        const tbody = document.getElementById('loanHistoryTableBody');
        const emptyState = document.getElementById('loanHistoryEmptyState');
        const sortedLoans = [...currentData.loanTransactions].sort((a, b) => new Date(b.borrowDate) - new Date(a.borrowDate));
        if (sortedLoans.length === 0) {
            tbody.innerHTML = '';
            emptyState.innerHTML = createEmptyState('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô', 'fa-solid fa-history');
            emptyState.classList.remove('hidden');
            return;
        }
        emptyState.classList.add('hidden');
        tbody.innerHTML = sortedLoans.map(loan => {
            const item = currentData.ppeItems.find(p => p.id == loan.itemId);
            const status = getStatusInfo(loan.status);
            return `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800">${item ? item.name : 'N/A'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${loan.borrowerName}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${new Date(loan.borrowDate).toLocaleDateString('th-TH')}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${loan.returnDate ? new Date(loan.returnDate).toLocaleDateString('th-TH') : '-'}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2.5 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full ${status.color}">${status.text}</span>
                    </td>
                </tr>`;
        }).join('');
    }

    // ===========================================
    // Form & Modal Logic
    // ===========================================
    function addIssueItem() {
        const container = document.getElementById('issueItems');
        const newItemDiv = document.createElement('div');
        newItemDiv.className = "issue-item flex flex-col sm:flex-row items-start sm:items-center gap-3 p-4 border border-gray-200 rounded-lg bg-gray-50";
        newItemDiv.innerHTML = `
            <select class="item-select flex-1 w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500" required>
                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</option>
            </select>
            <input type="number" class="item-quantity w-full sm:w-28 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" min="1" required>
            <button type="button" onclick="removeIssueItem(this)" class="px-3 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors w-full sm:w-auto">
                <i class="fas fa-trash"></i>
            </button>
        `;
        container.appendChild(newItemDiv);
        populateAllDropdowns();
    }
    function removeIssueItem(button) { button.closest('.issue-item').remove(); }
    function resetIssueForm() {
        const form = document.getElementById('issueForm');
        if (!form) return; // ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡πá‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô
        form.reset();
        const container = document.getElementById('issueItems');
        if (container) {
            container.innerHTML = '';
            addIssueItem();
        }
    }
    function showVoucherDetails(voucherId) {
        const voucher = currentData.issueVouchers.find(v => v.id == voucherId);
        if (!voucher) return;
        const itemsHtml = JSON.parse(voucher.itemsJson).map(item => {
            const ppeItem = currentData.ppeItems.find(p => p.id == item.itemId);
            return `<li class="flex justify-between"><span>${ppeItem ? ppeItem.name : 'N/A'}</span> <span class="font-medium">${item.quantity} ${ppeItem ? ppeItem.unit : ''}</span></li>`;
        }).join('');
        const status = getStatusInfo(voucher.status);
        const modal = document.getElementById('voucherModal');
        modal.innerHTML = `
            <div class="bg-white p-8 rounded-xl shadow-xl w-full max-w-lg m-4 relative">
                <button onclick="hideVoucherModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                <h3 class="text-xl font-semibold mb-2 text-gray-800">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å #${voucher.id}</h3>
                <span class="px-2.5 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full ${status.color}">${status.text}</span>
                <div class="mt-6 space-y-4 text-gray-700">
                    <div class="grid grid-cols-2 gap-4">
                        <p><strong>‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å:</strong> ${voucher.user}</p>
                        <p><strong>‡πÅ‡∏ú‡∏ô‡∏Å:</strong> ${voucher.department}</p>
                        <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å:</strong> ${new Date(voucher.timestamp).toLocaleDateString('th-TH', { dateStyle: 'medium' })}</p>
                    </div>
                    <div>
                        <p class="font-semibold mb-2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå:</p>
                        <ul class="space-y-1 bg-gray-50 p-4 rounded-lg">${itemsHtml}</ul>
                    </div>
                </div>
                <div class="mt-6 text-right">
                    <button onclick="hideVoucherModal()" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100">‡∏õ‡∏¥‡∏î</button>
                </div>
            </div>`;
        modal.classList.remove('hidden');
    }
    function hideVoucherModal() { document.getElementById('voucherModal').classList.add('hidden'); }
    function showApprovalModal(voucherId) {
        if (!isAdmin) return showToast('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ', 'error');
        const voucher = currentData.issueVouchers.find(v => v.id == voucherId);
        if (!voucher) return;
        const items = JSON.parse(voucher.itemsJson);
        const itemsHtml = items.map(item => {
            const ppeItem = currentData.ppeItems.find(p => p.id == item.itemId);
            const maxApprove = Math.min(item.quantity, ppeItem ? ppeItem.stock : 0);
            return `
                <div class="flex items-center space-x-3 p-3 border-b item-approval-row" data-item-id="${item.itemId}" data-item-name="${ppeItem ? ppeItem.name : ''}">
                    <div class="flex-1">
                        <p class="font-medium text-gray-800">${ppeItem ? ppeItem.name : 'N/A'}</p>
                        <p class="text-sm text-gray-600">‡∏Ç‡∏≠: ${item.quantity} | ‡∏™‡∏ï‡πá‡∏≠‡∏Å: ${ppeItem ? ppeItem.stock : 0}</p>
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥:</label>
                        <input type="number" value="${maxApprove}" min="0" max="${maxApprove}" class="approved-quantity w-20 px-2 py-1 border rounded focus:outline-none focus:ring-1 focus:ring-teal-500">
                    </div>
                </div>`;
        }).join('');
        const modal = document.getElementById('approvalModal');
        modal.innerHTML = `
            <div class="bg-white p-8 rounded-xl shadow-xl w-full max-w-md m-4 relative">
                <button onclick="hideApprovalModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                <h3 class="text-xl font-semibold mb-6 text-gray-800">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å #${voucher.id}</h3>
                <div class="mb-6 border rounded-lg bg-gray-50 p-4 max-h-60 overflow-y-auto">${itemsHtml}</div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button onclick="rejectVoucher(${voucher.id})" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</button>
                    <button onclick="approveVoucher(${voucher.id})" class="px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                    <button onclick="handlePartialApprove(${voucher.id})" class="px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</button>
                </div>
            </div>`;
        modal.classList.remove('hidden');
    }
    function hideApprovalModal() { document.getElementById('approvalModal').classList.add('hidden'); }
    function editItem(itemId) {
        const item = currentData.ppeItems.find(p => p.id == itemId);
        if (item) {
            document.getElementById('editItemId').value = item.id;
            document.getElementById('itemCode').value = item.code;
            document.getElementById('itemName').value = item.name;
            document.getElementById('itemCategory').value = item.category;
            document.getElementById('itemUnit').value = item.unit;
            document.getElementById('itemReorderPoint').value = item.reorderPoint;
            document.getElementById('itemStock').value = item.stock;
            document.getElementById('onLoanQuantity').value = item.onLoanQuantity || 0;
            showToast('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ' + item.name);
        }
    }
    function resetManageForm() {
        document.getElementById('manageForm').reset();
        document.getElementById('editItemId').value = '';
    }
    function resetReceiveForm() { document.getElementById('receiveForm').reset(); }
    function showConfirmationModal(title, message) {
        return new Promise(resolve => {
            const modal = document.getElementById('confirmationModal');
            document.getElementById('confirmationTitle').textContent = title;
            document.getElementById('confirmationMessage').textContent = message;
            modal.classList.remove('hidden');
            const confirmBtn = document.getElementById('confirmProceedBtn');
            const cancelBtn = document.getElementById('confirmCancelBtn');
            const newConfirmBtn = confirmBtn.cloneNode(true);
            confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);
            const newCancelBtn = cancelBtn.cloneNode(true);
            cancelBtn.parentNode.replaceChild(newCancelBtn, cancelBtn);
            const cleanup = () => {
                modal.classList.add('hidden');
                newConfirmBtn.removeEventListener('click', handleConfirm);
                newCancelBtn.removeEventListener('click', handleCancel);
            };
            const handleConfirm = () => { cleanup(); resolve(true); };
            const handleCancel = () => { cleanup(); resolve(false); };
            newConfirmBtn.addEventListener('click', handleConfirm);
            newCancelBtn.addEventListener('click', handleCancel);
        });
    }

    // ===========================================
    // Category Management Logic
    // ===========================================
    function showCategoryModal() {
        if (!isAdmin) return showToast('‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Admin ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô', 'error');
        document.getElementById('categoryManagementModal').classList.remove('hidden');
        resetCategoryForm();
        renderCategoryList();
    }
    function hideCategoryModal() {
        document.getElementById('categoryManagementModal').classList.add('hidden');
    }
    function renderCategoryList() {
        const container = document.getElementById('categoryListContainer');
        const sortedCategories = [...currentData.categories].sort((a, b) => a.name.localeCompare(b.name));
        if (sortedCategories.length === 0) {
            container.innerHTML = createEmptyState('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà', 'fa-solid fa-tags');
            return;
        }
        container.innerHTML = sortedCategories.map(cat => `
        <div class="flex justify-between items-center p-3 rounded-lg hover:bg-slate-800/40">
            <span class="text-slate-100">${cat.name}</span>
            <div class="space-x-2">
            <button onclick="editCategory(${cat.id}, &quot;${cat.name}&quot;)" class="text-slate-400 hover:text-teal-400">
                <i class="fas fa-edit"></i>
            </button>
            <button onclick="handleDeleteCategory(${cat.id})" class="text-slate-400 hover:text-red-400">
                <i class="fas fa-trash"></i>
            </button>
            </div>
        </div>
        `).join('');
    }
    function editCategory(id, name) {
        document.getElementById('editCategoryId').value = id;
        document.getElementById('categoryNameInput').value = name;
        document.getElementById('categoryNameInput').focus();
    }
    function resetCategoryForm() {
        document.getElementById('categoryForm').reset();
        document.getElementById('editCategoryId').value = '';
    }

    // ===========================================
    // >>>>>>>> ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ <<<<<<<<<<
    // Form Submission Handlers
    // ===========================================

    /**
     * Handles the submission of the issue form.
     */
    function handleIssueSubmit(e) {
        e.preventDefault();
        const user = document.getElementById('issueUser').value;
        const department = document.getElementById('issueDepartment').value;
        const items = [];
        const itemRows = document.querySelectorAll('#issueItems .issue-item');

        for (let row of itemRows) {
            const itemId = row.querySelector('.item-select').value;
            const quantity = row.querySelector('.item-quantity').value;
            if (itemId && quantity > 0) {
                items.push({ itemId: Number(itemId), quantity: Number(quantity) });
            }
        }

        if (items.length === 0) {
            return showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£', 'error');
        }

        const voucherData = { user, department, items };
        callServerFunction('addNewVoucher', voucherData)
            .then(newVoucher => {
                showToast(`‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å #${newVoucher.id} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`);
                resetIssueForm();
                initializeApp(); // Refresh data
            });
    }

    /**
     * Handles the submission of the manage/edit item form.
     */
    function handleManageSubmit(e) {
        e.preventDefault();
        if (!isAdmin) return showToast('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ', 'error');

        const itemData = {
            id: document.getElementById('editItemId').value || null,
            code: document.getElementById('itemCode').value,
            name: document.getElementById('itemName').value,
            category: document.getElementById('itemCategory').value,
            unit: document.getElementById('itemUnit').value,
            reorderPoint: Number(document.getElementById('itemReorderPoint').value),
            stock: Number(document.getElementById('itemStock').value),
            onLoanQuantity: Number(document.getElementById('onLoanQuantity').value || 0)
        };
        
        callServerFunction('savePpeItem', itemData)
            .then(result => {
                showToast(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• "${result.item.name}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`);
                resetManageForm();
                initializeApp();
            });
    }

    /**
     * Handles the submission of the receive stock form.
     */
    function handleReceiveSubmit(e) {
        e.preventDefault();
        if (!isAdmin) return showToast('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ', 'error');

        const transactionData = {
            itemId: Number(document.getElementById('receiveItem').value),
            quantity: Number(document.getElementById('receiveQuantity').value),
            type: document.getElementById('receiveType').value,
            user: document.getElementById('receiveUser').value,
            department: document.getElementById('receiveDepartment').value,
        };

        callServerFunction('addReceiveTransaction', transactionData)
            .then(() => {
                showToast('‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                resetReceiveForm();
                initializeApp();
            });
    }

    /**
     * Handles the submission of the borrow/loan form.
     */
    function handleBorrowSubmit(e) {
        e.preventDefault();
        const borrowData = {
            itemId: Number(document.getElementById('loanItem').value),
            borrowerName: document.getElementById('borrowerName').value,
            dueDate: document.getElementById('loanDueDate').value,
            notes: document.getElementById('loanNotes').value,
        };

        callServerFunction('borrowItem', borrowData)
            .then(() => {
                showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                document.getElementById('loanForm').reset();
                initializeApp();
            });
    }

    /**
     * Handles saving or updating a category.
     */
    function handleSaveCategory(e) {
        e.preventDefault();
        if (!isAdmin) return showToast('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ', 'error');

        const categoryData = {
            id: document.getElementById('editCategoryId').value || null,
            name: document.getElementById('categoryNameInput').value,
        };

        callServerFunction('saveCategory', categoryData)
            .then(() => {
                showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                resetCategoryForm();
                initializeApp(); // This will re-render the list
            });
    }

    /**
     * Handles deleting a category after confirmation.
     */
    async function handleDeleteCategory(categoryId) {
        if (!isAdmin) return showToast('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ', 'error');
        
        const confirmed = await showConfirmationModal('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö', '‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ô‡∏µ‡πâ? ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ');
        if (confirmed) {
            callServerFunction('deleteCategory', { categoryId })
                .then(() => {
                    showToast('‡∏•‡∏ö‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                    initializeApp();
                });
        }
    }

    /**
     * Handles returning a loaned item.
     */
    async function handleReturnItem(loanId) {
        const confirmed = await showConfirmationModal('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô', '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?');
        if (confirmed) {
            callServerFunction('returnItem', { loanId })
                .then(() => {
                    showToast('‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                    initializeApp();
                });
        }
    }

    // ===========================================
    // Voucher Approval Handlers
    // ===========================================

    async function approveVoucher(voucherId) {
        const confirmed = await showConfirmationModal('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å‡∏ô‡∏µ‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡∏î‡∏ó‡∏±‡∏ô‡∏ó‡∏µ');
        if (confirmed) {
            callServerFunction('approveVoucher', { voucherId })
                .then(() => {
                    showToast(`‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å #${voucherId} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`);
                    hideApprovalModal();
                    initializeApp();
                });
        }
    }

    async function rejectVoucher(voucherId) {
        const confirmed = await showConfirmationModal('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò', '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡πÉ‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?');
        if (confirmed) {
            callServerFunction('rejectVoucher', { voucherId })
                .then(() => {
                    showToast(`‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡πÉ‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å #${voucherId} ‡πÅ‡∏•‡πâ‡∏ß`);
                    hideApprovalModal();
                    initializeApp();
                });
        }
    }

    function handlePartialApprove(voucherId) {
        const items = [];
        document.querySelectorAll('#approvalModal .item-approval-row').forEach(row => {
            items.push({
                itemId: Number(row.dataset.itemId),
                itemName: row.dataset.itemName,
                quantity: Number(row.querySelector('.approved-quantity').value)
            });
        });

        const approvalData = { voucherId, items };
        callServerFunction('approvePartialVoucher', approvalData)
            .then(() => {
                showToast(`‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å #${voucherId} ‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`);
                hideApprovalModal();
                initializeApp();
            });
    }

</script>

    <!-- ‡πÇ‡∏°‡∏î‡∏±‡∏•‡∏ó‡∏µ‡πà JS ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ ‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤ -->
    <div id="voucherModal" class="fixed inset-0 z-[999] hidden bg-slate-950/70 backdrop"></div>
    <div id="approvalModal" class="fixed inset-0 z-[999] hidden bg-slate-950/70 backdrop"></div>
    <div id="confirmationModal" class="fixed inset-0 z-[999] hidden bg-slate-950/70 backdrop">
    <div class="bg-white text-slate-900 p-6 rounded-xl w-full max-w-sm mx-auto mt-24">
        <h3 id="confirmationTitle" class="text-lg font-semibold mb-2"></h3>
        <p id="confirmationMessage" class="text-sm mb-4"></p>
        <div class="flex justify-end gap-2">
        <button id="confirmCancelBtn" class="px-4 py-2 bg-slate-200 rounded-lg">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button id="confirmProceedBtn" class="px-4 py-2 bg-teal-500 text-white rounded-lg">‡∏ï‡∏Å‡∏•‡∏á</button>
        </div>
    </div>
    </div>
    <!-- CATEGORY MANAGEMENT MODAL -->
<div
  id="categoryManagementModal"
  class="fixed inset-0 z-[999] hidden bg-slate-950/70 backdrop flex items-center justify-center"
>
  <div class="bg-slate-900 border border-slate-700 rounded-2xl p-6 w-full max-w-md">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-base font-semibold text-slate-100">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà PPE</h2>
      <button
        onclick="hideCategoryModal()"
        class="h-8 w-8 rounded-full bg-slate-800 flex items-center justify-center"
      >
        <i class="fa-solid fa-xmark text-slate-200"></i>
      </button>
    </div>

    <form id="categoryForm" class="space-y-3" onsubmit="handleSaveCategory(event)">
      <input type="hidden" id="editCategoryId" />
      <div>
        <label class="text-xs text-slate-400">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
        <input
          id="categoryNameInput"
          class="mt-1 w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-slate-100"
          placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ñ‡∏∏‡∏á‡∏°‡∏∑‡∏≠, ‡∏´‡∏°‡∏ß‡∏Å‡∏ô‡∏¥‡∏£‡∏†‡∏±‡∏¢, ‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡πÄ‡∏ã‡∏ü‡∏ï‡∏µ‡πâ"
          required
        />
      </div>
      <div class="flex justify-end gap-2">
        <button type="button" onclick="hideCategoryModal()" class="px-4 py-2 bg-slate-700 rounded-lg text-slate-100 text-sm">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button type="submit" class="px-4 py-2 bg-teal-500 rounded-lg text-white text-sm">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      </div>
    </form>

    <div id="categoryListContainer" class="mt-5 space-y-2 max-h-60 overflow-y-auto"></div>
  </div>
</div>

  </body>
</html>
